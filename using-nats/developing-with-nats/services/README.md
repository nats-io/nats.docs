# Построение сервисов

Недавно мы согласовали [начальную спецификацию](https://github.com/nats-io/nats-architecture-and-design/blob/main/adr/ADR-32.md) протокола сервисов, чтобы добавить поддержку сервисов первого класса в клиенты NATS и поддержать это в инструментах. Этот протокол сервисов — соглашение между клиентами и инструментами и не требует специальной функциональности от сервера NATS или JetStream.

Чтобы проверить, поддерживает ли клиент NATS на вашем любимом языке новый API сервисов, обязательно посмотрите документацию и репозиторий GitHub этого клиента. API сервисов относительно новый, и не все клиенты могут поддерживать его на данный момент.

Чтобы увидеть API сервисов в действии на разных языках, посмотрите примеры [NATS By Example](https://natsbyexample.com/examples/services/intro/go).

## Концепции

Есть несколько высокоуровневых концепций API сервисов, которые важно понимать перед началом разработки собственных сервисов.

### Service

Service — абстракция верхнего уровня и относится к группе логически связанных функций. Сервисы должны иметь имя и версию, соответствующие правилам [semver](https://semver.org/#is-there-a-suggested-regular-expression-regex-to-check-a-semver-string). Сервисы доступны для обнаружения в системе NATS.

### Endpoint

Endpoint сервиса — сущность, с которой взаимодействуют клиенты. Можно думать об endpoint как об одной операции внутри сервиса. Все сервисы должны иметь как минимум один endpoint.

### Group

Group — коллекция endpoints. Это опционально и может предоставлять логическую связь между endpoints, а также опциональный общий префикс subject для всех endpoints.

## Операции сервисов

API сервисов поддерживает 3 операции для обнаружения и наблюдаемости. Хотя клиент NATS берёт на себя ответы на этих subject, ответственность разработчика — отвечать на запросы, направленные на реальные endpoints сервиса.

* `PING` — запросы на subject `$SRV.PING.>` собирают ответы от работающих сервисов. Это облегчает список сервисов для инструментов.
* `STATS` — запросы на subject `$SRV.STATS.>` запрашивают статистику сервисов. Доступная статистика включает общее число запросов, общее число ошибок и общее время обработки.
* `INFO` — запросы на subject `$SRV.INFO.>` получают определение сервиса и метаданные, включая группы, endpoints и т. д.
