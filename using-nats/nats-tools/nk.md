# nk

`nk` — утилита командной строки для генерации `nkeys`. NKeys — это высокозащищенная система подписи на публичных ключах, основанная на [Ed25519](https://ed25519.cr.yp.to/).

С NKeys сервер может проверять идентичность, никогда не храня секреты на сервере. Система аутентификации требует, чтобы подключающийся клиент предоставил публичный ключ и подписал challenge своим приватным ключом. Сервер генерирует случайный challenge при каждом запросе соединения, что защищает от атак повторного воспроизведения. Сгенерированная подпись проверяется публичным ключом, тем самым подтверждая личность клиента. Если проверка публичного ключа успешна — аутентификация успешна.

> NKey — отличная замена токенной аутентификации, потому что подключающийся клиент должен доказать, что контролирует приватный ключ для авторизованного публичного ключа.

## Установка nk

Чтобы начать работать с NKeys, вам нужен инструмент `nk` из репозитория [https://github.com/nats-io/nkeys/tree/master/nk](https://github.com/nats-io/nkeys/tree/master/nk). Если у вас установлен _go_, выполните в командной строке:

```bash
go install github.com/nats-io/nkeys/nk@latest
```

## Генерация NKeys и настройка сервера

Чтобы сгенерировать _User_ NKEY:

```shell
nk -gen user -pubout
```
```text
SUACSSL3UAHUDXKFSNVUZRF5UHPMWZ6BFDTJ7M6USDXIEDNPPQYYYCU3VY
UDXU4RCSJNZOIQHZNWXHXORDPRTGNJAHAHFRGZNEEJCPQTT2M7NLCNF4
```

Первая строка начинается с буквы `S` — _Seed_. Вторая буква `U` означает _User_. Seeds — это приватные ключи; относитесь к ним как к секретам и храните осторожно.

Вторая строка начинается с `U` — _User_ — это публичный ключ, который можно безопасно распространять.

Чтобы использовать аутентификацию `nkey`, добавьте пользователя и задайте свойство `nkey` равным публичному ключу пользователя, которого хотите аутентифицировать. Требуется только публичный ключ, другие свойства не обязательны. Пример конфигурации `nats-server`:

```
authorization: {
  users: [
    { nkey: UDXU4RCSJNZOIQHZNWXHXORDPRTGNJAHAHFRGZNEEJCPQTT2M7NLCNF4 }
  ]
}
```

Для завершения end‑to‑end конфигурации и использования `nkey` [клиент настраивается](https://docs.nats.io/running-a-nats-service/configuration/securing\_nats/auth\_intro/nkey\_auth#client-configuration) на использование seed — приватного ключа.
