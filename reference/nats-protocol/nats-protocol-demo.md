# Демонстрация протокола

Преимущества протокола NATS становятся очевидны сразу: работать с NATS очень просто. Так как протокол NATS текстовый, его можно использовать практически на любой платформе и языке.

В демонстрации ниже используется [Telnet](https://en.wikipedia.org/wiki/Telnet). По сети можно публиковать и подписываться, используя простой [набор протокольных команд](nats-protocol/).

## Инициализация соединения

Откройте терминал и подключитесь к демо-инстансу NATS.

```
telnet demo.nats.io 4222
```

Ожидаемый результат будет выглядеть примерно так. IP-адрес и payload `INFO` могут отличаться.

```
Trying 107.170.221.32...
Connected to demo.nats.io.
Escape character is '^]'.
INFO {"server_id":"NCXMJZYQEWUDJFLYLSTTE745I2WUNCVG3LJJ3NRKSFJXEG6RGK7753DJ","version":"2.0.0","proto":1,"go":"go1.11.10","host":"0.0.0.0","port":4222,"max_payload":1048576,"client_id":5089}
```

## Подтверждение соединения

Любой клиент после установки соединения обязан отправить `CONNECT`, чтобы подтвердить подключение. Можно передать набор параметров о поддерживаемых возможностях клиента, но для этого примера достаточно пустого payload.

```
CONNECT {}
```

В ответ придёт сообщение `+OK`.

## Наблюдение ping/pong-интервала

Вскоре после `CONNECT` вы увидите `PING`. Между клиентом и сервером работает двусторонняя проверка живости. Если сервер долго не получает `PONG`, он закроет клиентское соединение. Если клиент не получает `PONG`, он попытается переподключиться к другому серверу кластера (если доступно).

Ответьте серверу, просто набрав `PONG` и нажав Enter.

```
PONG
```

## Привязка подписки

Подпишитесь на wildcard-subject `foo.*` с ID подписки `90`.

```
SUB foo.* 90
```

После этого придёт `+OK`, означающий успешную подписку.

## Публикация сообщения

Соединение NATS двустороннее: можно не только подписываться, но и публиковать.

Отправьте команду `PUB`, затем subject и длину payload, который будет передан следующей строкой. В примере payload - `hello`. После ввода нажмите Enter, чтобы отправить сообщение.

```text
PUB foo.bar 5
hello
```

Придёт `+OK`, подтверждающий успешную публикацию.

Сразу после этого появится `MSG`, указывающий, что подписка получила только что опубликованное сообщение.

```text
MSG foo.bar 90 5
hello
```

## Отписка от subject

Для отписки используйте команду `UNSUB`.

Выполните отписку подписчика:

```text
UNSUB 90
```

## Повторная публикация

Теперь, когда подписка удалена, при повторной публикации вы снова получите `+OK`, но `MSG` уже не придёт.

```text
PUB foo.bar 7
goodbye
```

## Закрытие соединения

Используйте `ctrl+c`, чтобы закрыть соединение. Если этого не сделать, сервер закроет его автоматически после периода неактивности.
