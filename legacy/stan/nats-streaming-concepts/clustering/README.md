# Кластеризация

NATS Streaming Server поддерживает кластеризацию и репликацию данных на базе [алгоритма консенсуса Raft](https://raft.github.io/) для обеспечения высокой доступности. Это защищает от сбоев части узлов кластера, но горизонтально не масштабируется, так как лидер обрабатывает все входящие данные от издателей и исходящие данные к подписчикам. Размер кластера обычно стоит ограничивать 3-5 узлами \(RAFT рекомендует нечетное число узлов\).

Есть два способа инициализации кластера: явная конфигурация кластера или "auto"-конфигурация с использованием seed-узла. В первом случае указываются ID узлов-участников, и эти узлы выбирают лидера. Во втором случае один сервер запускается как seed-узел и выбирает себя лидером, а последующие серверы автоматически присоединяются к seed \(это также работает и с явной конфигурацией после выбора лидера\). При втором способе нужно избегать запуска нескольких seed-серверов, иначе возникнет split-brain. Оба способа показаны в разделах ниже.

Рекомендуется запускать нечетное количество серверов, минимум три, чтобы избежать split-brain-сценариев. Обратите внимание: если доступно меньше большинства серверов, кластер не может продолжать работу. Например, если в кластере из трех узлов отключились два, кластер недоступен, пока не вернется хотя бы один узел.

Примечание о Channels Partitioning и Clustering. Эти возможности взаимоисключающие. Попытка запустить сервер одновременно с включенными Channels Partitioning и Clustering приведет к ошибке старта. Для кластеризации требуется репликация всех каналов в кластере.

