# Адаптивные архитектуры развертывания NATS

От одного процесса до глобального супер‑кластера с leaf node серверами — вы всегда можете адаптировать развертывание сервиса NATS под свои нужды. От серверов и VPC в разных облаках до частично подключенных edge‑устройств и всего между ними — вы легко расширяете и масштабируете сервис NATS по мере роста потребностей.

## Один сервер

Самая простая версия инфраструктуры сервиса NATS — один процесс `nats-server`. Бинарник `nats-server` высоко оптимизирован, очень легкий и крайне эффективен по ресурсам.

Клиентские приложения подключаются к URL этого процесса nats-server (например, `"nats://localhost"`).

![](../.gitbook/assets/single-server.svg)

## Кластер серверов

Если вам нужна отказоустойчивость или масштабирование мощности сервиса, можно объединить несколько процессов nats-server в кластер.

Клиентские приложения устанавливают и поддерживают соединение с (одним из) URL серверов кластера (например, `"nats://server1","nats://server2",...`).

![](../.gitbook/assets/server-cluster.svg)

## Супер‑кластер

Можно пойти дальше одного кластера и обеспечить аварийное восстановление и глобальные развертывания (например, в нескольких локациях или регионах, нескольких VPC или у нескольких облачных провайдеров), развернув несколько кластеров и соединив их через gateway‑подключения (interest‑pruned).

Клиентские приложения подключаются к (одному из) URL серверов одного из кластеров (например, `"nats://us-west-1.company.com","nats://us-west-2.company.com",...`).

![](../.gitbook/assets/super_cluster.svg)

## С Leaf Nodes

Вы можете легко «расширить» сервис NATS, предоставляемый кластером или супер‑кластером, развернув локально один или несколько **leaf node** серверов NATS, которые проксируют и маршрутизируют трафик между клиентскими приложениями и инфраструктурой сервиса NATS. Контекст «локальности» здесь не только физический: это может быть локация, edge‑устройство или отдельная машина разработки, но также VPC, группа серверных процессов для конкретного приложения или разных аккаунтов, или даже бизнес‑единица. Leaf node серверы NATS могут быть настроены на подключение к своему кластеру по WebSocket (вместо TLS или обычного TCP).

Leaf nodes видятся кластеру как одно подключение аккаунта. Leaf nodes могут обеспечивать непрерывный сервис NATS для своих клиентов, даже при временном отключении от кластера(ов). Можно включить JetStream на leaf nodes, чтобы создавать локальные потоки, которые зеркалируются (store‑and‑forward, поэтому могут восстанавливаться после потери связи) в глобальные потоки в upstream‑кластере(ах).

Клиентские приложения настраиваются на URL своих «локальных» leaf node серверов и подключаются к (одному из) них (например, `"nats://leaf-node-1","nats://leaf-node-2",...`).

![](../.gitbook/assets/leaf_nodes.svg)

## См. также

NATS Clusters&#x20;

{% embed url="https://youtu.be/srARy0m9SdI" %}
Clusters
{% endembed %}

NATS Super‑clusters&#x20;

{% embed url="https://youtu.be/6O_sNSJ2p70" %}
Super-clusters
{% endembed %}

NATS Leaf Nodes&#x20;

{% embed url="https://youtu.be/WH55czo1BNk" %}
Leaf Nodes
{% endembed %}

NATS Service Geo‑affinity in Queues&#x20;

{% embed url="https://youtu.be/jLTVhP08Tq0?t=190" %}
Geo-affinity in Queues
{% endembed %}
