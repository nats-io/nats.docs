NATS — это система обмена сообщениями [publish‑subscribe](pubsub.md), [основанная на subjects](../../subjects.md). Подписчики, слушающие subject, получают сообщения, опубликованные на этом subject. Если подписчик не слушает subject активно, сообщение не будет получено. Подписчики могут использовать wildcard‑токены `*` и `>` для сопоставления одного токена или хвоста subject.

# Пошаговое руководство по NATS Pub/Sub
  
Это простое руководство показывает, как подписчики слушают subjects, а издатели отправляют сообщения в конкретные subjects.  
  
![](../../../.gitbook/assets/pubsubtut.svg)

## Подготовка

Если вы еще этого не сделали, вам нужно [установить](../../what-is-nats/walkthrough_setup.md) CLI‑инструмент `nats` и при необходимости `nats-server` на вашей машине.

### 1. Создайте подписчика 1

В сессии shell или командной строки запустите клиентскую программу‑подписчик.  

```bash
nats sub <subject>
```
  
Здесь `<subject>` — subject, который нужно слушать. Лучше использовать уникальные и продуманные строки subjects, чтобы сообщения доходили до правильных подписчиков, даже когда используются wildcards.
  
Например:  

```bash
nats sub msg.test
```

Вы должны увидеть сообщение: _Listening on \[msg.test\]_

### 2. Создайте издателя и опубликуйте сообщение

В другой сессии shell или командной строки создайте издателя NATS и отправьте сообщение.  

```bash
nats pub <subject> <message>
```

Где `<subject>` — имя subject, а `<message>` — публикуемый текст.

Например:

```bash
nats pub msg.test "NATS MESSAGE"
```

### 3. Проверьте публикацию и получение сообщения

Вы увидите, что издатель отправляет сообщение и печатает: _Published \[msg.test\] : 'NATS MESSAGE'_.

Подписчик получает сообщение и печатает: _\[\#1\] Received on \[msg.test\]: 'NATS MESSAGE'_.

Если получатель не получает сообщение, проверьте, что вы используете одинаковое имя subject у издателя и у подписчика.  

### 4. Попробуйте опубликовать еще одно сообщение

```bash
nats pub msg.test "NATS MESSAGE 2"
```

Вы заметите, что подписчик получает сообщение.  
Обратите внимание, что счетчик сообщений увеличивается каждый раз, когда ваш подписчик получает сообщение на этом subject.  

### 5. Создайте подписчика 2

В новой сессии shell или командной строки запустите нового подписчика NATS.  

```bash
nats sub msg.test
```

### 6. Опубликуйте еще одно сообщение от издателя

```bash
nats pub msg.test "NATS MESSAGE 3"
```

Убедитесь, что оба подписчика получают сообщение.

### 7. Создайте подписчика 3

В новой сессии shell или командной строки создайте нового подписчика, который слушает другой subject.  

```bash
nats sub msg.test.new
```

### 8. Опубликуйте еще одно сообщение

```bash
nats pub msg.test "NATS MESSAGE 4"
```

Подписчики 1 и 2 получают сообщение, а подписчик 3 — нет. Почему? Потому что подписчик 3 не слушает subject, на который отправляет издатель.

### 9. Измените подписчика 3, используя wildcard

Измените последнего подписчика так, чтобы он слушал `msg.*`, и запустите его:  

```bash
nats sub msg.*
```
  
Примечание: NATS поддерживает использование wildcards только для подписчиков. Публиковать сообщения в subject с wildcard нельзя.

### 10. Опубликуйте еще одно сообщение

```bash
nats pub msg.test "NATS MESSAGE 5"
```
  
На этот раз все три подписчика должны получить сообщение.  
  
Попробуйте еще несколько вариантов подстрок и wildcards, чтобы проверить понимание.  


# См. также

Паттерн publish‑subscribe с NATS CLI&#x20;

{% embed url="https://www.youtube.com/watch?v=jLTVhP08Tq0" %}
Publish-subscribe pattern - NATS CLI
{% endembed %}

