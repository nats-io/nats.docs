# Пошаговое руководство по очередям NATS

NATS поддерживает форму балансировки нагрузки с помощью [групп очередей](queue.md). Подписчики указывают имя группы очереди. Для получения сообщения случайным образом выбирается один подписчик из группы.

## Подготовка

Если вы еще этого не сделали, вам нужно [установить](/nats-concepts/what-is-nats/walkthrough_setup.md) CLI‑инструмент `nats` и, при необходимости, `nats-server` на вашей машине.

### 1. Запустите первого участника группы очереди

Экземпляры `nats reply` не только подписываются на subject, но и автоматически присоединяются к группе очереди (по умолчанию `"NATS-RPLY-22"`).

```bash
nats reply foo "service instance A Reply# {{Count}}"
```

### 2. Запустите второго участника группы очереди

В новом окне:

```bash
nats reply foo "service instance B Reply# {{Count}}"
```

### 3. Запустите третьего участника группы очереди

В новом окне:

```bash
nats reply foo "service instance C Reply# {{Count}}"
```

### 4. Отправьте сообщение NATS

```bash
nats request foo "Simple request"
```

### 5. Проверьте публикацию и получение сообщения

Вы увидите, что сообщение получает и отвечает только один подписчик группы очереди, а также сможете определить, кто именно обработал запрос по полученному ответу (например, service instance A, B или C).

### 6. Отправьте еще одно сообщение

```bash
nats request foo "Another simple request"
```

На этот раз сообщение получит другой подписчик группы очереди, выбранный случайным образом среди 3 участников.

Вы также можете отправлять сколько угодно запросов подряд. По полученным ответам вы увидите распределение запросов между участниками группы очереди. Например: `nats request foo --count 10 "Request {{Count}}"`

### 7. Остановите/запустите участников группы очереди

Вы можете в любой момент запустить еще один экземпляр сервиса или остановить один из них и увидеть, как группа очереди автоматически добавляет/удаляет экземпляры из группы.


## См. также

Группы очередей с NATS CLI

{% embed url="https://youtu.be/jLTVhP08Tq0?t=101" %}
Queue Groups NATS CLI
{% endembed %}
