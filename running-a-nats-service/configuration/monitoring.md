# Включение мониторинга

## Мониторинг сервера NATS

Для мониторинга системы обмена сообщениями NATS `nats-server` предоставляет легковесный HTTP‑сервер на отдельном порту мониторинга. Сервер мониторинга предоставляет несколько endpoint’ов со статистикой и прочей информацией.

[Эндпоинты мониторинга NATS](../nats_admin/monitoring/) поддерживают [JSONP](https://en.wikipedia.org/wiki/JSONP) и [CORS](https://en.wikipedia.org/wiki/Cross-origin_resource_sharing#How_CORS_works), что упрощает создание одностраничных web‑приложений для мониторинга.

> Предупреждение: у `nats-server` нет аутентификации/авторизации для endpoint’ов мониторинга. Если вы планируете открыть `nats-server` в интернет, убедитесь, что не выставляете наружу порт мониторинга. По умолчанию мониторинг привязан ко всем интерфейсам `0.0.0.0`, поэтому рассмотрите привязку к `localhost` или настройте соответствующие правила firewall.

### Включение мониторинга из командной строки

Чтобы включить сервер мониторинга, запустите NATS‑сервер с флагом мониторинга `-m` и портом мониторинга или включите его в [конфигурационном файле](monitoring.md#enable-monitoring-from-the-configuration-file).

```
-m, --http_port PORT             HTTP‑порт мониторинга
-ms,--https_port PORT            Использовать HTTPS‑порт для мониторинга
```

Пример:

```bash
nats-server -m 8222
```

```
[4528] 2019/06/01 20:09:58.572939 [INF] Starting nats-server version 2.0.0
[4528] 2019/06/01 20:09:58.573007 [INF] Starting http monitor on port 8222
[4528] 2019/06/01 20:09:58.573071 [INF] Listening for client connections on 0.0.0.0:4222
[4528] 2019/06/01 20:09:58.573090 [INF] nats-server is ready
```

Для проверки запустите `nats-server -m 8222`, затем перейдите на [http://localhost:8222/](http://localhost:8222/)

### Включение мониторинга из конфигурационного файла

Также можно включить мониторинг через конфигурационный файл:

```yaml
http_port: 8222
```

С привязкой к `localhost`:

```yaml
http: localhost:8222
```

Например, чтобы мониторить сервер локально, endpoint будет [http://localhost:8222/varz](http://localhost:8222/varz). Он показывает различные общие статистики.

## Инструменты мониторинга

Помимо написания собственных инструментов мониторинга, можно мониторить nats-server через Prometheus. [Prometheus NATS Exporter](https://github.com/nats-io/prometheus-nats-exporter) позволяет настраивать метрики и сохранять их в Prometheus. Есть пример дашборда [Grafana](https://grafana.com), который можно использовать для визуализации метрик сервера.
