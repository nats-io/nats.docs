# Клиенты сервера NATS

Клиент NATS — это приложение, которое подключается к одному из серверов NATS, указанных в URL подключения, и использует файл учетных данных для аутентификации и подтверждения авторизации на сервере и во всей инфраструктуре NATS.

`nats-server` не поставляется с какими‑либо клиентами, но его «компаньон» — CLI‑инструмент [`nats`](../using-nats/nats-tools/nats_cli/) — стоит установить (даже если вы не планируете запускать свои серверы), так как это лучший инструмент для тестирования, мониторинга, управления и общего взаимодействия с инфраструктурой NATS (независимо от того, это изолированный локальный сервер, leaf‑node сервер, кластер или даже глобальный супер‑кластер).

Другие полезные клиентские инструменты NATS: CLI‑инструмент [`nsc`](../using-nats/nats-tools/nsc/) (для управления атрибутами аккаунтов и JWT токенами пользователей) и инструмент (и библиотека) [`nk`](../using-nats/nats-tools/nk.md) для управления NKeys.

Также большинство клиентских библиотек поставляется с примерами программ, позволяющими публиковать, подписываться, отправлять запросы и отвечать на сообщения.

## Встраивание NATS

Если ваше приложение на Go и это подходит под ваш сценарий использования и развертывания, вы можете встроить сервер NATS прямо в приложение.

[Embedding NATS in Go](https://dev.to/karanpratapsingh/embedding-nats-in-go-19o)

## Установка CLI‑инструмента `nats`

См. [раздел установки в readme](https://github.com/nats-io/natscli?tab=readme-ov-file#installation).


## Проверка установки

Откройте терминал и [запустите nats-server](broken-reference):

```shell
nats-server
```

```
[45695] 2021/09/29 02:22:53.570667 [INF] Starting nats-server
[45695] 2021/09/29 02:22:53.570796 [INF]   Version:  2.6.1
[45695] 2021/09/29 02:22:53.570799 [INF]   Git:      [not set]
[45695] 2021/09/29 02:22:53.570804 [INF]   Name:     NAAACXGWSD6ZW5KVHOTSGGPU2JCMZUDSMY5GVZZP27DMRPWYINC2X6ZI
[45695] 2021/09/29 02:22:53.570807 [INF]   ID:       NAAACXGWSD6ZW5KVHOTSGGPU2JCMZUDSMY5GVZZP27DMRPWYINC2X6ZI
[45695] 2021/09/29 02:22:53.571747 [INF] Listening for client connections on 0.0.0.0:4222
[45695] 2021/09/29 02:22:53.572051 [INF] Server is ready
```

В другом терминале сначала проверьте подключение к серверу:

```shell
nats server check connection -s nats://0.0.0.0:4222
```

```
OK Connection OK:connected to nats://127.0.0.1:4222 in 790.28µs OK:rtt time 69.896µs OK:round trip took 0.000102s | connect_time=0.0008s;0.5000;1.0000 rtt=0.0001s;0.5000;1.0000 request_time=0.0001s;0.5000;1.0000
```

Затем запустите подписчика с помощью CLI‑инструмента `nats`:

```shell
nats subscribe ">" -s nats://0.0.0.0:4222
```

Обратите внимание: когда клиент подключился, сервер ничего интересного не залогировал, потому что вывод сервера относительно тихий, пока не происходит чего‑то примечательного.

Чтобы сделать вывод сервера более «живым», можно указать флаг `-V`, включающий трассировку протокольных сообщений. Остановите процесс сервера (`<ctrl>+c`) и перезапустите его с `-V`:

```shell
nats-server -V
```

```
[45703] 2021/09/29 02:23:05.189377 [INF] Starting nats-server
[45703] 2021/09/29 02:23:05.189489 [INF]   Version:  2.6.1
[45703] 2021/09/29 02:23:05.189493 [INF]   Git:      [not set]
[45703] 2021/09/29 02:23:05.189497 [INF]   Name:     NAIBOVQLOZSDIUFQYZOQUGV3PNZUT66D4WF5MKS2G7N423UGJDH2DFWG
[45703] 2021/09/29 02:23:05.189500 [INF]   ID:       NAIBOVQLOZSDIUFQYZOQUGV3PNZUT66D4WF5MKS2G7N423UGJDH2DFWG
[45703] 2021/09/29 02:23:05.190236 [INF] Listening for client connections on 0.0.0.0:4222
[45703] 2021/09/29 02:23:05.190504 [INF] Server is ready
[45703] 2021/09/29 02:23:07.111053 [TRC] 127.0.0.1:51653 - cid:4 - <<- [CONNECT {"verbose":false,"pedantic":false,"tls_required":false,"name":"NATS CLI Version 0.0.26","lang":"go","version":"1.12.0","protocol":1,"echo":true,"headers":true,"no_responders":true}]
[45703] 2021/09/29 02:23:07.111282 [TRC] 127.0.0.1:51653 - cid:4 - "v1.12.0:go:NATS CLI Version 0.0.26" - <<- [PING]
[45703] 2021/09/29 02:23:07.111301 [TRC] 127.0.0.1:51653 - cid:4 - "v1.12.0:go:NATS CLI Version 0.0.26" - ->> [PONG]
[45703] 2021/09/29 02:23:07.111632 [TRC] 127.0.0.1:51653 - cid:4 - "v1.12.0:go:NATS CLI Version 0.0.26" - <<- [SUB >  1]
[45703] 2021/09/29 02:23:07.111679 [TRC] 127.0.0.1:51653 - cid:4 - "v1.12.0:go:NATS CLI Version 0.0.26" - <<- [PING]
[45703] 2021/09/29 02:23:07.111689 [TRC] 127.0.0.1:51653 - cid:4 - "v1.12.0:go:NATS CLI Version 0.0.26" - ->> [PONG]
```

Если вы создали подписчика, вы должны заметить сообщение о том, что он отключился и переподключился. Вывод сервера выше более интересен: вы видите, как подписчик отправляет протокольное сообщение `CONNECT` и `PING`, на которое сервер отвечает `PONG`.

> Подробнее о [протоколе NATS](../reference-protocols.md), а еще интереснее — [интерактивная демонстрация](../reference/nats-protocol/nats-protocol-demo.md).

В третьем терминале опубликуйте первое сообщение:

```shell
nats pub hello world -s nats://0.0.0.0:4222
```

В окне подписчика вы должны увидеть:

```
[#1] Received on "hello"
world
```

## Проверка подключения к удаленному серверу

Если сервер NATS запущен на другой машине или другом порту, это нужно указать клиенту, задав _NATS URL_ (либо в `nats context`, либо через флаг `-s`).

### NATS URL

NATS URL имеет вид `nats://<server>:<port>` и `tls://<server>:<port>`. URL с протоколом `tls` используют защищенное TLS‑соединение.

Если вы подключаетесь к кластеру, можно указать несколько URL (через запятую), например `nats://localhost:4222,nats://localhost:5222,nats://localhost:6222`, если у вас тестовый кластер из 3 серверов NATS на локальной машине, слушающих порты 4222, 5222 и 6222 соответственно.

### Пример

```shell
nats sub -s nats://server:port ">"
```

Если хотите попробовать подключение к удаленному серверу, команда NATS поддерживает демо‑сервер по адресу `demo.nats.io`.

```shell
nats sub -s nats://demo.nats.io ">"
```
