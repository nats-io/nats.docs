# Запуск

`nats-server` имеет множество опций командной строки. Для старта ничего указывать не нужно. При отсутствии флагов сервер NATS начинает слушать клиентские соединения на порту 4222. По умолчанию безопасность отключена.

## Автономный режим

При запуске сервер выводит информацию, включая адрес прослушивания клиентских соединений:

```shell
nats-server
```
```text
[61052] 2021/10/28 16:53:38.003205 [INF] Starting nats-server
[61052] 2021/10/28 16:53:38.003329 [INF]   Version:  2.6.1
[61052] 2021/10/28 16:53:38.003333 [INF]   Git:      [not set]
[61052] 2021/10/28 16:53:38.003339 [INF]   Name:     NDUP6JO4T5LRUEXZUHWXMJYMG4IZAJDNWETTA4GPJ7DKXLJUXBN3UP3M
[61052] 2021/10/28 16:53:38.003342 [INF]   ID:       NDUP6JO4T5LRUEXZUHWXMJYMG4IZAJDNWETTA4GPJ7DKXLJUXBN3UP3M
[61052] 2021/10/28 16:53:38.004046 [INF] Listening for client connections on 0.0.0.0:4222
[61052] 2021/10/28 16:53:38.004683 [INF] Server is ready
...
```

## Docker

Если вы запускаете сервер NATS в контейнере Docker:

```shell
docker run -p 4222:4222 -ti nats:latest
```
```text
[1] 2021/10/28 23:51:52.705376 [INF] Starting nats-server
[1] 2021/10/28 23:51:52.705428 [INF]   Version:  2.6.1
[1] 2021/10/28 23:51:52.705432 [INF]   Git:      [c91f0fe]
[1] 2021/10/28 23:51:52.705439 [INF]   Name:     NB32AP7VSM3FTKTVEGPQ3OZWSE4T7PQDVJSJMGYFIDKJA6TQEZMV2JNN
[1] 2021/10/28 23:51:52.705446 [INF]   ID:       NB32AP7VSM3FTKTVEGPQ3OZWSE4T7PQDVJSJMGYFIDKJA6TQEZMV2JNN
[1] 2021/10/28 23:51:52.705448 [INF] Using configuration file: nats-server.conf
[1] 2021/10/28 23:51:52.709505 [INF] Starting http monitor on 0.0.0.0:8222
[1] 2021/10/28 23:51:52.709590 [INF] Listening for client connections on 0.0.0.0:4222
[1] 2021/10/28 23:51:52.709882 [INF] Server is ready
[1] 2021/10/28 23:51:52.710394 [INF] Cluster name is 3tlKqFWx91wnnAekR76U9V
[1] 2021/10/28 23:51:52.710419 [WRN] Cluster name was dynamically generated, consider setting one
[1] 2021/10/28 23:51:52.710446 [INF] Listening for route connections on 0.0.0.0:6222
...
```

## Запуск nats-server как systemd‑сервиса на Linux

Вы можете легко и быстро использовать `systemd` для запуска (и перезапуска при необходимости) процесса `nats-server`.

См. примеры файлов в директории `util` репозитория [nats-server](https://github.com/nats-io/nats-server/tree/main/util), которые можно использовать для генерации собственного файла `/etc/systemd/system/nats.service`.

## Код завершения

Для долгоживущего сервиса важно понимать, какие гарантии `nats-server` дает по завершению работы и что это означает.

Выбранный подход `nats-server` таков: «корректное завершение после запроса на остановку» считается успешным выходом — даже на платформах, где запрос остановки приходит в виде POSIX‑сигнала. Успешный выход по запросу остановки не является ошибкой.

При настройке менеджера сервисов (будь то `systemd` или иной) мы рекомендуем настраивать перезапуск `nats-server` при ненулевом коде завершения, смерти от сигнала или любом другом ненормальном выходе, чтобы менеджер делал то, что он делает лучше всего: поддерживал доступность критически важных сервисов. Менеджер сервисов, вероятно, не должен перезапускать `nats-server`, если тот завершился успешно. Если ваша среда не предоставляет способа взаимодействовать с `nats-server` кроме как через агент сервиса, то разницы нет; эта разница становится заметной, когда кто‑то кроме менеджера сервисов попросил `nats-server` завершиться.

## JetStream

Помните, что для включения JetStream и всех функций, которые его используют, нужно включить его как минимум на одном из серверов.

### Командная строка

Включите JetStream, указав флаг `-js` при запуске сервера NATS.

`$ nats-server -js`

### Конфигурационный файл

JetStream можно включить через конфигурационный файл. По умолчанию подсистема JetStream хранит данные в каталоге `/tmp`. Ниже минимальный файл, который хранит данные в локальном каталоге "nats", подходящий для разработки и локального тестирования.

```shell
nats-server -c js.conf
```

```text
# js.conf
jetstream {
   store_dir=nats
}
```

Обычно JetStream запускается в кластерном режиме и реплицирует данные, поэтому лучшее место для хранения данных JetStream — локальный быстрый SSD. Следует явно избегать NAS или NFS‑хранилищ для JetStream.
Подробнее о [NATS в контейнерах](nats_docker/).
