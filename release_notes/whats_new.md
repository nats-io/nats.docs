# Что нового!

Команда NATS.io постоянно работает над новыми возможностями, чтобы улучшить ваш опыт использования NATS. Ниже приведены краткие обзоры недавних релизов.
Актуальные заметки к патч-релизам доступны на странице [GitHub Releases](https://github.com/nats-io/nats-server/releases).

## Дорожная карта будущих релизов

Смотрите [https://nats.io/about/#roadmap](https://nats.io/about/#roadmap).

## Релиз сервера v2.12.0

Ознакомьтесь с:

- [Руководством по обновлению](./whats_new_212.md)
- [Заметками о релизе](https://github.com/nats-io/nats-server/releases/tag/v2.12.0)

## Релиз сервера v2.11.0

Ознакомьтесь с:

- [Руководством по обновлению](./whats_new_211.md)
- [Заметками о релизе](https://github.com/nats-io/nats-server/releases/tag/v2.11.0)

## Релиз сервера v2.10.0

Ознакомьтесь с:

- [Руководством по обновлению](./whats_new_210.md)
- [Подкастом EP06: Путь и функции релиза NATS.io 2.10](https://youtu.be/9J4pRzHSc2k)
- [Заметками о релизе](https://github.com/nats-io/nats-server/releases/tag/v2.10.0)

## Релиз сервера v2.9.0

Ознакомьтесь со [статьей-объявлением](https://nats.io/blog/nats-server-29-release/) в блоге и [подробными заметками](https://github.com/nats-io/nats-server/releases/tag/v2.9.0) в репозитории сервера.

## Релиз сервера v2.8.0

### LeafNode

Добавлена поддержка параметра `min_version` внутри блока `leafnodes{}` — он отвергает подключения серверов с версией ниже указанной. Работает только на серверах версии v2.8.0 и выше.

### Мониторинг

- Версия сервера отображается на главной странице мониторинга.
- Логирование в `/healthz`, если происходит сбой.
- Блоки MQTT и WebSocket доступны в `/varz`.

### JetStream

- Добавлена проверка потребителей на endpoint `healthz`.
- Проверки максимального размера потоков.
- Возможность ограничивать `MaxAckPending` для потребителя.
- Позволяют потокам и потребителям мигрировать между кластерами. _Функция в состоянии «бета»_.
- Новый параметр `unique_tag` в блоке `jetstream{}` предотвращает размещение потока дважды в одной зоне доступности.
- Поле `Alternates` в ответе `StreamInfo` содержит приоритетный список зеркал и источника относительно запроса.
- Детеминированное отображение subject-токенов на партиции.

Полная информация о релизе:

- [Заметки о релизе 2.8.0](https://github.com/nats-io/nats-server/releases/tag/v2.8.0)
- [Список изменений 2.7.4...2.8.0](https://github.com/nats-io/nats-server/compare/v2.7.4...v2.8.0)

## Релиз сервера v2.7.0

### **Уведомление для пользователей JetStream**

Смотрите [важную заметку](https://github.com/nats-io/nats-server/pull/2693#issuecomment-996212582) про LeafNode и домены.

### Конфигурация

Можно задавать лимиты учетных записей (`max_connections`, `max_subscriptions`, `max_payload`, `max_leafnodes`) в конфигурации сервера.

### JetStream

- Появилась возможность размещать потоки в ближайшем к источнику запросов кластере, если такая маршрутизация возможна.
- Поддержка эфемерных Pull-потребителей (клиентские библиотеки должны обновиться).
- Новые опции конфигурации потребителей:
  - Для Pull-потребителей: `MaxRequestBatch` ограничивает размер запрашиваемых пакетов, `MaxRequestExpires` ограничивает срок действия запроса.
  - Для эфемерных потребителей: `InactiveThreshold` указывает, как долго сервер ждет активности перед удалением такого потребителя.
- Можно задавать `max_file_store` и `max_memory_store` в блоке `jetstream{}` строками с суффиксами `K`, `M`, `G`, `T`, например `max_file_store: "256M"`.
- Поддерживается поле JWT `MaxBytesRequired`, которое определяет максимальный размер ресурсов на учетную запись.

### MQTT

Поддержка протокола WebSocket. Клиенты MQTT должны подключаться к открытому WebSocket-порту и добавлять `/mqtt` в путь URL.

### TLS

Добавлена возможность ограничивать частоту подключений клиентов через `connection_rate_limit: <число подключений в секунду>` в верхнем блоке `tls{}`.

Полная информация о релизе:

- [Заметки о релизе 2.7.0](https://github.com/nats-io/nats-server/releases/tag/v2.7.0)
- [Список изменений 2.6.6...2.7.0](https://github.com/nats-io/nats-server/compare/v2.6.6...v2.7.0)

## Релиз сервера v2.6.0

### **Уведомление для пользователей JetStream**

Смотрите важную [заметку](https://github.com/nats-io/nats-server/releases/tag/v2.4.0), если вы обновляетесь с версии до NATS Server v2.4.0.

### Уведомление для пользователей MQTT

Смотрите важные [заметки](https://github.com/nats-io/nats-server/releases/tag/v2.5.0), если вы обновляетесь с версии до v2.5.0.

### Мониторинг

- Отображается зарезервированная память JetStream и память, используемая учетными записями с резервированием, на `/jsz` и `/varz`.
- Укреплена служба systemd.

Полная информация о релизе:

- [Заметки о релизе 2.6.0](https://github.com/nats-io/nats-server/releases/tag/v2.6.0)
- [Список изменений 2.5.0...2.6.0](https://github.com/nats-io/nats-server/compare/v2.5.0...v2.6.0)

## Релиз сервера v2.5.0

### **Уведомление для пользователей JetStream**

См. важную [заметку](./#notice-for-jetstream-users), если вы обновляетесь с версии до NATS Server v2.4.0.

### MQTT/Мониторинг

- `MQTTClient` теперь отображается в отчете `/connz` и системные события CONNECT и DISCONNECT. Добавлена возможность фильтрации по `mqtt_client`.

### Улучшение MQTT

- Все сессии теперь хранятся в одном потоке вместо отдельных, что снижает расход ресурсов.

### Обновление MQTT

- После обновления до этой версии сервера MQTT-клиент при первом подключении инициирует миграцию всех индивидуальных потоков `$MQTT_sess_<xxxx>` в новый поток `$MQTT_sess` своей учетной записи.

Полная информация о релизе:

- [Заметки о релизе 2.5.0](https://github.com/nats-io/nats-server/releases/tag/v2.5.0)
- [Список изменений 2.4.0...2.5.0](https://github.com/nats-io/nats-server/compare/v2.4.0...v2.5.0)

## Релиз сервера v2.4.0

### Уведомление для пользователей JetStream

В последнем релизе сервера NATS исправлены ошибки, связанные с очередями подписок, и ограничено поведение, которое могло привести к путанице или потере данных из-за непреднамеренного использования API клиентскими приложениями. Если вы используете очереди подписок для JetStream Push Consumer или создали несколько push-подписок на одном и том же consumer’е, вы можете столкнуться с проблемами и требуется обновление клиентских библиотек вместе с серверной частью. Ниже описано поведение разных версий клиента.

Если сервер и клиент **оба** версии до v2.4.0 (в т.ч. NATS C v3.1.0, Go v1.12.0, Java 2.12.0-SNAPSHOT, NATS.js v2.2.0, NATS.ws v1.3.0, NATS.deno v1.2.0, NATS .NET 0.14.0-pre2):

- Возможно создание нескольких экземпляров не-queue-подписок для одного JetStream durable consumer, что приводит к дублирующим сообщениям и некорректным подтверждениям.
- Можно создавать разные группы очередей на один и тот же JetStream consumer.
- При отсутствии consumer или durable name создавались эфемерные потребители, и каждый член группы получал одно и то же сообщение, вместо балансировки нагрузки.
- Создание queue-подписки для consumer’а с heartbeat и/или flow control приводило к ложным пропускам heartbeat и нарушало flow control.

Если клиентские библиотеки старые, а сервер уже v2.4.0:

- Всё ещё можно создавать несколько экземпляров не-queue-подписок, так как проверка выполняется на стороне библиотеки (использует поле `PushBound`).
- Queue-подписки не будут получать сообщения: поле `DeliverGroup` не установлено старой библиотекой, и сервер думает, что потребитель не предназначен для queue-подписок.

Оставшиеся две проблемы всё ещё актуальны, так как их проверка по-прежнему делается в клиентских библиотеках.

Если библиотека обновлена, а сервер всё ещё старее v2.4.0:

- Можно создавать два экземпляра не-queue-подписок для одного JetStream consumer, поскольку сервер не передаёт `PushBound`.
- Queue-подписки будут падать с ошибкой о попытке подписаться на не-queue consumer, отсутствует поле `DeliverGroup`.
- При отсутствии durable/consumer name библиотека будет использовать queue group как durable name.
- Попытки создать queue-подписку с heartbeat/flow control теперь возвращают ошибку.

Если сервер v2.4.0 восстанавливает существующие JetStream consumers, созданные до v2.4.0 (с более старыми библиотеками), у них не будет `DeliverGroup`, и их нельзя будет использовать для queue-подписок. Потребуется создание заново.

### JetStream

- Переход поля `PubAck` протокола в доменную область
- Булево `PushBound` в `ConsumerInfo`, показывающее, что push-потребитель уже привязан к активной подписке
- Строка `DeliverGroup` в `ConsumerConfig`, определяющая имя группы доставки (queue group)
- Предупреждение в логах, если catchup для потока завершился ошибкой

### Мониторинг

- Возможность обычных учетных записей получать scoped-информацию `/connz`

### Разное

- Опция оператора `resolver_pinned_accounts`, требующая подписи пользователей определёнными учетными записями

Полная информация о релизе:

- [Заметки о релизе 2.4.0](https://github.com/nats-io/nats-server/releases/tag/v2.4.0)
- [Список изменений 2.3.4...2.4.0](https://github.com/nats-io/nats-server/compare/v2.3.4...v2.4.0)

## Релиз сервера v2.3.0

- [Поддержка OCSP](../running-a-nats-service/configuration/ocsp.md)

### JetStream

- Более подробные ошибки API: в JetStream теперь есть `ErrCode`, уникально описывающий ошибку.
- Возможность отправлять расширенные запросы очистки потока с выборкой по subject.
- Поток можно настроить с ограничением количества сообщений для каждого subject.
- Шифрование данных JetStream в состоянии покоя.

Полная информация о релизе:

- [Заметки о релизе 2.3.0](https://github.com/nats-io/nats-server/releases/tag/v2.3.0)
- [Список изменений 2.2.6...2.3.0](https://github.com/nats-io/nats-server/compare/v2.2.6...v2.3.0)

## Релиз сервера v2.2.0

См. [NATS 2.2](whats_new_22.md) для новых возможностей.

## Релиз сервера v2.1.7

### Мониторинговые endpoint’ы через системные сервисы

Мониторинговые endpoint’ы из таблицы ниже доступны в виде системных сервисов по шаблону subject:

- `$SYS.REQ.SERVER.<id>.<endpoint-name>` (запрос к серверному endpoint, соответствующему имени)
- `$SYS.REQ.SERVER.PING.<endpoint-name>` (запрос к серверному endpoint; может вернуться несколько сообщений)

Для подробностей обратитесь к разделу [Системные события конфигурации NATS](../running-a-nats-service/configuration/sys_accounts/).

### Добавление конфигурации `no_auth_user`

Параметр `no_auth_user` позволяет указывать заранее созданного пользователя/учетную запись, если учетные данные не передаются.

Больше информации и примеров в разделе [Securing NATS](../running-a-nats-service/configuration/securing_nats/)

Полная информация о релизе:

- [Заметки о релизе 2.1.7](https://github.com/nats-io/nats-server/releases/tag/v2.1.7)
- [Список изменений 2.1.6...2.1.7](https://github.com/nats-io/nats-server/compare/v2.1.6...v2.1.7)

## Релиз сервера v2.1.6

### TLS-конфигурация для resolver’а учетных записей

Теперь можно задавать TLS-настройки для resolver’а учетных записей.

```
resolver_tls {
  cert_file: ...
  key_file: ...
  ca_file: ...
}
```

### Дополнительные опции трассировки и отладки

Добавлены `trace_verbose` и командные параметры `-VV`, `-DVV`. Смотрите [Настройку логирования NATS](../running-a-nats-service/configuration/logging.md#configuring-logging).

### Детали подписок в endpoint’ах мониторинга

В `/routez` и `/connz` появилась опция `subs=detail`: теперь возвращается не только subject, но и имя очереди (если есть) и другие метаданные.

- [Заметки о релизе 2.1.6](https://github.com/nats-io/nats-server/releases/tag/v2.1.6)
- [Список изменений 2.1.4...2.1.6](https://github.com/nats-io/nats-server/compare/v2.1.4...v2.1.6)

## Релиз сервера v2.1.4

### Ротация логов

Появился параметр `logfile_size_limit`, позволяющий автоматически вращать файлы логов при достижении заданного размера в байтах. Можно указывать величину с единицами (MB, GB и т.п.). Файлы резервных копий получают тот же путь с суффиксом `.yyyy.mm.dd.hh.mm.ss.micros`. Подробнее — в [разделе Конфигурация логов](../running-a-nats-service/configuration/logging.md).

- [Заметки о релизе 2.1.4](https://github.com/nats-io/nats-server/releases/tag/v2.1.4)
- [Список изменений 2.1.2...2.1.4](https://github.com/nats-io/nats-server/compare/v2.1.2...v2.1.4)

## Релиз сервера v2.1.2

### Разрешения для очередей

Queue Permissions позволяют задавать авторизацию для входа в группы очередей. Группы очередей — ключ к масштабируемым микросервисам, поэтому важно управлять тем, кто может к ним подключаться. Изначальный PR — [https://github.com/nats-io/nats-server/pull/1143](https://github.com/nats-io/nats-server/pull/1143).

Подробности есть в разделе [Разработка с NATS](../using-nats/developing-with-nats/receiving/queues.md).

## Релиз сервера v2.1.0

### Отслеживание задержек сервисов

По мере роста сервисной архитектуры и mesh-функциональности мы искали способы сделать работу масштабируемых сервисов на NATS.io приятной. Наблюдаемость в publish/subscribe системах была очевидной, но мы хотели сделать её проще. Мы добавили возможность прозрачно включать сбор метрик задержек для любой экспортированной службы без изменений в приложении. Мы также поняли, что глобальные системы требуют больше, чем один показатель, поэтому можно задать любую частоту сэмплирования и единый subject для всех собранных метрик. Мы фиксируем задержки с точки зрения инициатора запроса, обработчика и самой подсистемы NATS, даже если они находятся в разных регионах и подключены к разным серверам супер-кластера.

- [Заметки о релизе 2.1.0](https://github.com/nats-io/nats-server/releases/tag/v2.1.0)
- [Список изменений 2.0.4...2.1.0](https://github.com/nats-io/nats-server/compare/v2.0.4...v2.1.0)

## Релиз сервера v2.0.4

### Разрешения только на ответ

Для сервисов авторизация часто включала wildcard для `_INBOX.>` и, при супер-кластере, `$GR.>` для ответов. Мы хотели дать возможность сервисному обработчику отвечать только на тот subject, на который пришёл запрос.

### Типы ответов

Экспортированные сервисы раньше были привязаны к одному типу ответа. Мы добавили возможность выбирать тип: singletons (по умолчанию), streams или chunked. Stream-ответы переводят несколько сообщений, chunked — один ответ, разбиваемый на части.

- [Заметки о релизе 2.0.4](https://github.com/nats-io/nats-server/releases/tag/v2.0.4)
- [Список изменений 2.0.2...2.0.4](https://github.com/nats-io/nats-server/compare/v2.0.2...v2.0.4)
