# 序列号

在一对多消息中，一个常见的问题是消息可能由于网络故障而丢失或被丢弃。解决这种情况的一种简单方法是，在消息中包含一个序列号（sequence id）。接收方可以通过检查序列号来判断是否遗漏了某些内容。在没有新数据的情况下，序列号与心跳机制相结合，可以形成一种强大且具有弹性的模式，用于检测消息丢失。存储和持久化消息的系统也可以解决这个问题，但有时对于当前的问题来说可能过于复杂，并且通常会带来额外的管理和运营成本。

![](../.gitbook/assets/seqno.svg)

为了真正利用序列号，需要注意以下几点：

* 每个发送方必须使用自己的序列号
* 如果可能，接收方应能够通过序列号请求缺失的消息

在 NATS 中，你可以将序列号嵌入到消息中，或者将其作为标记（token）包含在主题（subject）中。例如，发送方可以向 `updates.1`、`updates.2` 等主题发送消息，而订阅者可以监听 `updates.*` 并解析主题以确定序列号。如果负载（payload）未知，或者无法在负载中嵌入额外的数据（如序列号），则将序列号作为标记放置在主题中可能是可取的。