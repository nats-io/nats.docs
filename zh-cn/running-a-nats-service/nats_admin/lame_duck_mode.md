# 跛脚鸭模式

在生产环境中，我们建议服务器以​跛脚鸭模式​（lame duck mode）优雅地关闭，以便缓慢驱逐客户端。对于大规模部署，这可以缓解“惊群”（thundering herd）问题，避免大量启用TLS的客户端在相同时间重新连接时对服务器造成CPU压力。

## 服务器

通过向服务器发送信号即可启动跛脚鸭模式：

```shell
nats-server --signal ldm
```

进入跛脚鸭模式后，服务器将停止接受新的连接，并等待10秒的宽限期，然后开始在一段时间内驱逐客户端。该时间段可通过配置选项 [lame_duck_duration](https://docs.nats.io/nats-server/configuration#runtime-configuration) 进行配置，默认为2分钟。

## 客户端

当服务器进入跛脚鸭模式时，会向客户端发送一条消息。一些由维护者支持的客户端会调用一个可选回调函数，通知服务器即将进入跛脚鸭模式。这可用于应用程序需要在被驱逐后 短暂中断期间，提前准备并自动重新连接到另一台服务器的情况。